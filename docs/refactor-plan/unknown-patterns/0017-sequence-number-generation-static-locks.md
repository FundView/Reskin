# 0017 - Sequence Number Generation with Process-Scoped Locks

- Pattern label: Sequence numbers are generated by reading a table row, incrementing it, and saving while holding an in-process lock from `FVDataContextFactory.GetLockObject()`.
- Service/controller: `FundViewGit/FundView.MVC4.UI/EFModel/Helpers/spViolationNumberHelper.cs`.
- Difference summary (vs known playbooks): GL/AP playbook expects concurrency control at the data boundary (DB transaction or service-level adapter). Process-scoped locks rely on single-process behavior and HTTP-context-derived lock dictionaries, which complicates scaling and .NET 9 reuse.
- Search results (other occurrences, paths): 5 helper classes using `FVDataContextFactory.GetLockObject()` for per-city sequence locks.
- Candidate solutions (core boundary, adapter shape, tests):
- Introduce `ISequenceNumberService` or `ISequenceStore` adapter with transactional DB updates (retain current table/behavior).
- Keep lock semantics in the legacy adapter only; core services request sequence numbers via interface.
- Add characterization tests around number generation to verify uniqueness and increment behavior per city/database.

Subpattern: Process-scoped lock-based increments
- Search results list (active):
- `FundViewGit/FundView.MVC4.UI/EFModel/Helpers/spViolationNumberHelper.cs`
- `FundViewGit/FundView.MVC4.UI/EFModel/Helpers/spProjectNumberHelper.cs`
- `FundViewGit/FundView.MVC4.UI/EFModel/Helpers/spJurorNumberHelper.cs`
- `FundViewGit/FundView.MVC4.UI/EFModel/Helpers/spDocketNumberHelper.cs`
- `FundViewGit/FundView.MVC4.UI/EFModel/Helpers/spCitationNumberHelper.cs`

Related variants (no process lock, but sequence semantics)
- `FundViewGit/FundView.MVC4.UI/EFModel/Helpers/spCourtTransactionNumberHelper.cs`
- `FundViewGit/FundView.MVC4.UI/EFModel/Helpers/spCourtPaymentPlanTransactionNumberHelper.cs`
- `FundViewGit/FundView.MVC4.UI/EFModel/Helpers/spBPProjectNumberHelper.cs`
